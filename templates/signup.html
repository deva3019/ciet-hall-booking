<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Sign Up â€¢ CIET Hall Booking</title>
    <link rel="icon" href="/static/images/college_logo.png" />

    <script src="https://unpkg.com/tailwindcss-cdn@3.4.1/tailwindcss.js"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        (function () {
          try {
            const saved = localStorage.getItem('theme');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.documentElement.classList.toggle('dark', saved ? saved === 'dark' : prefersDark);
          } catch(e) {}
        })();
    </script>

    <style>
        * { scroll-behavior: smooth; }

        .swal2-confirm {
          background-color: #4f46e5 !important;
          color: white !important;
          font-weight: 600 !important;
          border: none !important;
          padding: 12px 32px !important;
          font-size: 16px !important;
          border-radius: 8px !important;
        }

        .swal2-confirm:hover {
          background-color: #4338ca !important;
        }

        .swal2-html-container {
          color: #1f2937 !important;
          font-size: 15px !important;
        }

        .swal2-popup {
          background-color: white !important;
          border-radius: 16px !important;
        }

        .swal2-title {
          color: #1f2937 !important;
          font-size: 24px !important;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 text-slate-900 dark:text-white min-h-screen">
<div class="pointer-events-none fixed inset-0 -z-10">
    <div class="absolute -top-40 -left-40 w-80 h-80 rounded-full bg-indigo-500/30 dark:bg-indigo-500/20 blur-3xl"></div>
    <div class="absolute -bottom-40 -right-40 w-80 h-80 rounded-full bg-purple-500/20 dark:bg-purple-500/10 blur-3xl"></div>
</div>

<header class="border-b border-slate-200/50 dark:border-white/5 bg-white/40 dark:bg-slate-900/40 backdrop-blur-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex items-center justify-between">
        <a href="index.html" class="flex items-center gap-2 hover:opacity-80 transition">
            <img src="/static/images/college_logo.png" alt="CIET" class="w-8 sm:w-10 h-8 sm:h-10" />
            <span class="text-xs sm:text-sm font-bold hidden sm:inline">CIET</span>
        </a>
        <a href="login.html" class="px-3 sm:px-5 py-2 rounded-lg bg-slate-900 text-white text-xs sm:text-sm hover:bg-slate-800 dark:bg-white dark:text-slate-900 dark:hover:bg-slate-100 transition font-medium">
            Sign In
        </a>
    </div>
</header>

<main class="min-h-screen flex items-center justify-center px-4 sm:px-6 py-8 sm:py-12">
    <div class="w-full max-w-5xl">
        <div class="hidden lg:grid lg:grid-cols-2 lg:gap-12 lg:items-center">
            <div>
                <div class="space-y-8">
                    <div>
                        <h1 class="text-4xl lg:text-5xl font-bold leading-tight">
                            Create Your<br /><span class="bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">Account</span>
                        </h1>
                        <div class="w-20 h-1 bg-gradient-to-r from-indigo-600 to-purple-600 mt-6 rounded-full"></div>
                    </div>

                    <p class="text-slate-600 dark:text-slate-300 text-base leading-relaxed">
                        Join CIET's intelligent hall booking system and manage auditorium and seminar hall reservations with ease.
                    </p>

                    <div class="space-y-4">
                        <div class="flex items-start gap-3">
                            <span class="text-2xl">ðŸ”’</span>
                            <div>
                                <p class="font-semibold text-slate-900 dark:text-white">Secure</p>
                                <p class="text-sm text-slate-600 dark:text-slate-400">Your data is protected</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <span class="text-2xl">ðŸ‘¥</span>
                            <div>
                                <p class="font-semibold text-slate-900 dark:text-white">Role-Based</p>
                                <p class="text-sm text-slate-600 dark:text-slate-400">Different access levels</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <span class="text-2xl">âš¡</span>
                            <div>
                                <p class="font-semibold text-slate-900 dark:text-white">Fast & Easy</p>
                                <p class="text-sm text-slate-600 dark:text-slate-400">Book in seconds</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <div class="p-8 rounded-2xl bg-white/70 dark:bg-slate-900/70 backdrop-blur-xl border border-slate-200/50 dark:border-white/10 shadow-2xl">
                    <form id="signupForm" class="space-y-5">
                        <div>
                            <label for="username" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Username</label>
                            <input id="username" type="text" placeholder="john_doe" class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition" required />
                        </div>

                        <div>
                            <label for="fullName" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Full Name</label>
                            <input id="fullName" type="text" placeholder="John Doe" class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition" required />
                        </div>

                        <div>
                            <label for="email" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Email</label>
                            <input id="email" type="email" placeholder="john@ciet.edu" class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition" required />
                        </div>

                        <div>
                            <label for="role" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Role</label>
                            <select id="role" name="role" required class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition">
                                <option value="">Select role...</option>
                                <option value="staff">Staff / HOD</option>
                                <option value="administrator">Administrator</option>
                                <option value="principal">Principal</option>
                            </select>
                        </div>

                        <div id="deptContainer">
                            <label for="department" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Department</label>
                            <select id="department" class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition" required>
                                <option value="">Select department...</option>
                                <option value="CSE">Computer Science Engineering</option>
                                <option value="ECE">Electronics & Communication</option>
                                <option value="AIDS">Artificial Intelligence & Data Science</option>
                                <option value="MCT">Mechatronics</option>
                                <option value="CIVIL">Civil Engineering</option>
                                <option value="MECH">Mechanical Engineering</option>
                                <option value="IT">Information Technology</option>
                                <option value="CYBER SECURITY">Cyber Security</option>
                                <option value="VLSI">VLSI Design</option>
                                <option value="EEE">Electrical & Electronics Engineering</option>
                                <option value="AIML">AI & Machine Learning</option>
                                <option value="S&H">Science & Humanities</option>
                                <option value="MBA">MBA</option>
                                <option value="Placement">Placement Cell</option>
                            </select>
                        </div>

                        <div>
                            <label for="password" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Password</label>
                            <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition" required />
                        </div>

                        <div>
                            <label for="secretCode" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Secret Code</label>
                            <input id="secretCode" type="password" placeholder="Enter college secret code" class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition" required />
                        </div>

                        <button type="submit" class="w-full mt-7 px-4 py-2.5 rounded-lg bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold hover:from-indigo-500 hover:to-purple-500 transition text-sm shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95">
                            Create Account
                        </button>

                        <p class="text-center text-xs text-slate-600 dark:text-slate-400 pt-2">
                            Have an account? <a href="login.html" class="text-indigo-600 dark:text-indigo-400 font-semibold hover:underline">Sign In</a>
                        </p>
                    </form>
                </div>
            </div>
        </div>

        <div class="lg:hidden max-w-md mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-3xl sm:text-4xl font-bold mb-2">
                    Create<br /><span class="bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">Account</span>
                </h1>
                <div class="w-16 h-1 bg-gradient-to-r from-indigo-600 to-purple-600 mx-auto rounded-full"></div>
            </div>

            <p class="text-center text-slate-600 dark:text-slate-300 text-sm mb-8">Join CIET's hall booking system</p>

            <div class="p-6 sm:p-8 rounded-2xl bg-white/70 dark:bg-slate-900/70 backdrop-blur-xl border border-slate-200/50 dark:border-white/10 shadow-2xl">
                <form id="signupFormMobile" class="space-y-4">
                    <div>
                        <label for="username-mobile" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Username</label>
                        <input id="username-mobile" type="text" placeholder="john_doe" class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition" required />
                    </div>
                    <div>
                        <label for="fullName-mobile" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Full Name</label>
                        <input id="fullName-mobile" type="text" placeholder="John Doe" class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition" required />
                    </div>
                    <div>
                        <label for="email-mobile" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Email</label>
                        <input id="email-mobile" type="email" placeholder="john@ciet.edu" class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition" required />
                    </div>
                    <div>
                        <label for="role-mobile" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Role</label>
                        <select id="role-mobile" class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition" required>
                            <option value="">Select role...</option>
                            <option value="staff">Staff / HOD</option>
                            <option value="administrator">Administrator</option>
                            <option value="principal">Principal</option>
                        </select>
                    </div>

                    <div id="deptContainerMobile">
                        <label for="department-mobile" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Department</label>
                        <select id="department-mobile" class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition" required>
                            <option value="">Select department...</option>
                            <option value="CSE">Computer Science Engineering</option>
                            <option value="ECE">Electronics & Communication</option>
                            <option value="AIDS">Artificial Intelligence & Data Science</option>
                            <option value="MCT">Mechatronics</option>
                            <option value="CIVIL">Civil Engineering</option>
                            <option value="MECH">Mechanical Engineering</option>
                            <option value="IT">Information Technology</option>
                            <option value="CYBER SECURITY">Cyber Security</option>
                            <option value="VLSI">VLSI Design</option>
                            <option value="EEE">Electrical & Electronics Engineering</option>
                            <option value="AIML">AI & Machine Learning</option>
                            <option value="MBA">MBA</option>
                            <option value="S&H">Science & Humanities</option>
                            <option value="Placement">Placement Cell</option>
                        </select>
                    </div>

                    <div>
                        <label for="password-mobile" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Password</label>
                        <input id="password-mobile" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition" required />
                    </div>

                    <div>
                        <label for="secretCode-mobile" class="text-xs font-bold uppercase tracking-wide text-slate-700 dark:text-slate-300 block mb-2">Secret Code</label>
                        <input id="secretCode-mobile" type="password" placeholder="Enter college secret code" class="w-full px-4 py-2.5 rounded-lg border border-slate-300/60 dark:border-white/15 bg-white dark:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition" required />
                    </div>

                    <button type="submit" class="w-full mt-6 px-4 py-2.5 rounded-lg bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold hover:from-indigo-500 hover:to-purple-500 transition text-sm shadow-lg hover:shadow-xl">
                        Create Account
                    </button>

                    <p class="text-center text-xs text-slate-600 dark:text-slate-300 pt-2">
                        Have an account? <a href="login.html" class="text-indigo-600 dark:text-indigo-400 font-semibold hover:underline">Sign In</a>
                    </p>
                </form>
            </div>
        </div>
    </div>
</main>

<script>
    const apiBase = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
    ? 'http://localhost:5000'  // Local development
    : 'https://ciet-hall-booking.onrender.com';  // Production

  console.log('ðŸ”— API Base URL:', apiBase);

    // Updated forms config to include secretCode
    const forms = [
      {
        form: 'signupForm',
        username: 'username',
        fullName: 'fullName',
        email: 'email',
        role: 'role',
        dept: 'department',
        password: 'password',
        secretCode: 'secretCode', // New
        deptContainer: 'deptContainer'
      },
      {
        form: 'signupFormMobile',
        username: 'username-mobile',
        fullName: 'fullName-mobile',
        email: 'email-mobile',
        role: 'role-mobile',
        dept: 'department-mobile',
        password: 'password-mobile',
        secretCode: 'secretCode-mobile', // New
        deptContainer: 'deptContainerMobile'
      }
    ];

      forms.forEach(config => {
        const form = document.getElementById(config.form);
        if (!form) return;

        // Toggle department field based on role selection
        document.getElementById(config.role).addEventListener('change', (e) => {
          const deptContainer = document.getElementById(config.deptContainer);
          const deptSelect = document.getElementById(config.dept);

          if (e.target.value === 'principal' || e.target.value === 'administrator') {
            deptContainer.style.display = 'none';
            deptSelect.removeAttribute('required');
            deptSelect.value = '';
          } else {
            deptContainer.style.display = 'block';
            deptSelect.setAttribute('required', 'required');
          }
        });

        // Form submit handler
        form.addEventListener('submit', async (e) => {
          e.preventDefault();

          const username = document.getElementById(config.username).value.trim();
          const fullName = document.getElementById(config.fullName).value.trim();
          const email = document.getElementById(config.email).value.trim();
          const role = document.getElementById(config.role).value;
          const department = (role === 'principal' || role === 'administrator') ? 'All' : document.getElementById(config.dept).value;
          const password = document.getElementById(config.password).value;
          const secretCode = document.getElementById(config.secretCode).value.trim(); // Get secret code

          if (!username || !fullName || !email || !role || !password || !secretCode) {
            Swal.fire({ icon: 'error', title: 'Missing Fields', text: 'Please fill all fields including Secret Code', confirmButtonColor: '#4f46e5' });
            return;
          }

          // --- NEW SECRET CODE VALIDATION ---
          if (secretCode !== 'staff@ciet') {
            Swal.fire({
              icon: 'error',
              title: 'Access Denied',
              text: 'Invalid Secret Code. Please contact administration.',
              confirmButtonColor: '#ef4444'
            });
            return;
          }
          // ----------------------------------

          if (!(role === 'principal' || role === 'administrator') && !department) {
            Swal.fire({ icon: 'error', title: 'Error', text: 'Please select a department', confirmButtonColor: '#4f46e5' });
            return;
          }

          try {
            const res = await fetch(`${apiBase}/signup`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ username, full_name: fullName, email, role, department, password })
            });

            const data = await res.json();

            if (!res.ok) {
              Swal.fire({ icon: 'error', title: 'Error', text: data.message, confirmButtonColor: '#4f46e5' });
              return;
            }

            Swal.fire({
              icon: 'success',
              title: 'Account Created! âœ…',
              html: `Your account has been created successfully. You can now login.`,
              confirmButtonText: 'Go to Login',
              confirmButtonColor: '#4f46e5',
              allowOutsideClick: false
            }).then(() => {
              location.href = 'login.html';
            });
          } catch (err) {
            console.error('Error:', err);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Network error', confirmButtonColor: '#4f46e5' });
          }

        });
      });
</script>
</body>
</html>